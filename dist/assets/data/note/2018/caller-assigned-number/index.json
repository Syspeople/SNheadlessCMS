{"hash":"9aa6fc4199609a4def2827be26b3f097c6fcb218","data":{"note":{"id":"858d3f3bf58eea0e0dccfb2493609c5f","title":"Caller, Assigned to og Number er tomme i mail","year":2018,"content":"<p>LP: <a href=\"https://app.liquidplanner.com/space/143625/my_work/panel/45710728\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://app.liquidplanner.com/space/143625/my_work/panel/45710728</a></p>\n<p>Caller, Assigned to og Number skal være udfyldt i mail-templaten <a href=\"https://scandlinestest.service-now.com/nav_to.do?uri=%2Fsysevent_email_action.do%3Fsys_id%3D0a9fe2f7dbb453008772969adb961994%26sysparm_view%3Dadvanced%26sysparm_record_target%3Dsysevent_email_action%26sysparm_view_forced%3Dtrue\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SLA breached Incident</a>:</p>\n<h5 id=\"fra-lp\"><a href=\"#fra-lp\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Fra LP</h5>\n<p>User Story:\nAs an itil-role user*, I want to receive notifications of Incident SLA breaches when it's actually breached, so that I know exactly when an Incident is due resolution.</p>\n<p>Acceptance Criteria:\n100% SLA breach of Incidents are being notfied to Ole Rasmussen via \"SLA breached Incident\"</p>\n<p>Resourcer:</p>\n<ul>\n<li>Notifications, som er ansvarlig for adviseringenslogik vedr. SLA. Se specifikt \"SLA breached Incident\", som er Oles fokus</li>\n<li>Default SLA Workflow, som irammesætter sekvensen af notificaitons\n<a href=\"https://scandlinestest.service-now.com/workflow_ide.do?sysparm_nostack=true\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://scandlinestest.service-now.com/workflow_ide.do?sysparm_nostack=true</a></li>\n</ul>\n<p>*Indtil videre skal modtageren af denne notification hard-codes til Ole Rasmussen selv.</p>\n<p>**\"As a <role>, I want <goal or need>, so that <benefit>.\"</p>\n<h5 id=\"historik\"><a href=\"#historik\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Historik</h5>\n<p>From \tKim Hougaard Simonsen (khs@syspeople.dk)\nTo \t45710728-605453f1cd06dddd0b53286d2a9f6cea@in.liquidplanner.com\nSubject \tFW: ! SLA: Assign. to: , No. Caller:</p>\n<p>FW</p>\n<p>Venlig hilsen / Best regards</p>\n<p>Kim Hougaard Simonsen</p>\n<p>Solution Architect</p>\n<p>Tel: +45 27 57 88 60</p>\n<p>From: Kim Hougaard Simonsen\nSent: 12. juni 2018 10:50\nTo: 'Rasmussen, Ole' <a href=\"mailto:Ole.Rasmussen@scandlines.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ole.Rasmussen@scandlines.com</a>\nSubject: RE: ! SLA: Assign. to: , No. Caller:</p>\n<p>Hej Ole,</p>\n<p>Jeg har ordnet problemet med den fejlbehæftede notification i anledning af SLA breaches. Det jeg har gjort er at skifte table til task_sla inden jeg rettede dot-walk til root-tabellen task , samt erstattet det ene mail script med dot-walked funktioner.</p>\n<p>Vil du verificere i <a href=\"https://scandlinestest.service-now.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://scandlinestest.service-now.com/</a> og kvittere med positiv/negativ resultat? =)</p>\n<p>Update Set: Scandlines - \"Caller\", \"Assigned to\" og \"Number\" er tomme i mail</p>\n<p>*Update Set er oprettet og completed i Sub-Production (<a href=\"https://scandlinestest.service-now.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://scandlinestest.service-now.com/</a>)</p>\n<p>Efter rettelsen:</p>\n<p>Caller: ${task.caller_id}</p>\n<p>Number: ${task.number}</p>\n<p>Assigned to: ${task.assigned_to}</p>\n<p>Header: ${task.short_description}</p>\n<p>Category: ${task.category}</p>\n<p>Severity: ${task.severity}</p>\n<p>Priority: ${task.priority}</p>\n<p>Comments: ${task.comments}</p>\n<p>${mail_script:incident_take_me_to_the_incident}</p>\n<p>Før rettelsen:</p>\n<p>Caller: ${incident.caller_id}</p>\n<p>Number: ${incident.number}</p>\n<p>Assigned to: ${incident.assigned_to}</p>\n<p>Header: ${mail_script:incident_body_header}</p>\n<p>${mail_script:incident_additional_details}</p>\n<p>${mail_script:incident_take_me_to_the_incident}</p>\n<p>Venlig hilsen / Best regards</p>\n<p>Kim Hougaard Simonsen</p>\n<p>Solution Architect</p>\n<p>Tel: +45 27 57 88 60</p>\n<p>From: Rasmussen, Ole <a href=\"mailto:Ole.Rasmussen@scandlines.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ole.Rasmussen@scandlines.com</a>\nSent: 10. juni 2018 00:26\nTo: Kim Hougaard Simonsen <a href=\"mailto:khs@syspeople.dk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">khs@syspeople.dk</a>\nSubject: Fwd: ! SLA: Assign. to: , No. Caller:</p>\n<p>Sendt fra min iPad</p>\n<p>Start på videresendt besked:</p>\n<pre><code>Fra: IT Service Desk &#x3C;scandlines@service-now.com>\nDato: 10. juni 2018 kl. 00.07.09 CEST\nTil: &#x3C;Ole.Rasmussen@scandlines.com>\nEmne: ! SLA: Assign. to: , No.  Caller:\nSvar til: IT Service Desk &#x3C;scandlines@service-now.com>\n\nCaller:\nNumber:\nAssigned to:\nHeader:\n\n-\n\nAdditional Details:\n\nCaller:\n\ncategory:\n\nSeverity:\n\nPriority:\n\nComments:\n\nYou can view all the details of the incident by following the link below:\n\nTake me to the Incident\n\nThank you.\n\nBest regards\nIT HelpDesk\n\nRef:MSG0128923\n</code></pre>\n<p>SReply AllSReply\nUnassigned\nUnassigned\nFri 08/06/18 07:45 AM\nFrom \tTestmails (testmails@syspeople.dk)\nTo \t45710728-605453f1cd06dddd0b53286d2a9f6cea@in.liquidplanner.com\nSubject \tFW: !!! SLA breach warning. Incident Assigned to: Kim 'itil' Hougaard simonsen for INC0014648. Caller: Berit Schreiner Dobson</p>\n<p>FW</p>\n<p>Venlig hilsen / Best regards</p>\n<p>Kim Hougaard Simonsen</p>\n<p>Solution Architect</p>\n<p>Tel: +45 27 57 88 60</p>\n<p>From: IT Service Desk <a href=\"mailto:scandlinestest@service-now.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">scandlinestest@service-now.com</a>\nSent: 8. juni 2018 07:43\nTo: Testmails <a href=\"mailto:testmails@syspeople.dk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">testmails@syspeople.dk</a>\nSubject: !!! SLA breach warning. Incident Assigned to: Kim 'itil' Hougaard simonsen for INC0014648. Caller: Berit Schreiner Dobson</p>\n<p>Caller: Berit Schreiner Dobson\nNumber: INC0014648\nAssigned to: Kim 'itil' Hougaard simonsen\nHeader:</p>\n<p>INC0014648 - SS-512 :Confirmation/Tickets and flex level</p>\n<p>Additional Details:</p>\n<p>Caller: Berit Schreiner Dobson</p>\n<p>category: Inquiry / Help</p>\n<p>Severity: 3 - Low</p>\n<p>Priority: 1 - Critical</p>\n<p>Comments:</p>\n<p>2017-12-02 09:40:49 CET - Jutta Just Additional comments</p>\n<p>We removed some time ago the Flexibility level description from the confirmations and the tickets if an offercode was available.</p>\n<p>Our sales department requires now that for all\npassenger vehicle products (car, carl, mhome, mhomel) the offercode AND the flexibility level shall be printed on the ticket.</p>\n<p>You can view all the details of the incident by following the link below:</p>\n<p>Take me to the Incident</p>\n<p>Thank you.</p>\n<p>Best regards\nIT HelpDesk</p>\n<p>Ref:MSG0105690\nSReply AllSReply\nKHS\nKHS\nThu 07/06/18 04:27 PM\nKan ske at være så simpelt som \"Send to event creator\", som er unchecked af ren uvidenhed.\nSReply AllSReply\nSNotes\nEdit\nLast edited by TUH on Tue 22/05/18 02:20 PM\nFrom \tTim Unnerup Husum (tuh@syspeople.dk)\nTo \t22516647-605453f1cd06dddd0b53286d2a9f6cea@in.liquidplanner.com\nSubject \tScandlines - ”Caller”, ”Assigned to” og ”Number” er tomme i mail</p>\n<p>From: Rasmussen, Ole <a href=\"mailto:Ole.Rasmussen@scandlines.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ole.Rasmussen@scandlines.com</a>\nSent: Friday, May 18, 2018 2:36 PM\nTo: Tim Unnerup Husum <a href=\"mailto:tuh@syspeople.dk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">tuh@syspeople.dk</a>\nCc: Mikkel Leth-Nissen <a href=\"mailto:mln@syspeople.dk\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">mln@syspeople.dk</a>\nSubject: RE: Projektopstart</p>\n<p>Hej Tim,</p>\n<p>Det lyder super!</p>\n<p>Mikkel snakkede om, I godt ville prøve en lille \"challenge\", som jeg ikke har fået tilfredsstillende svar på fra vore nuværende leverandør…:-)</p>\n<p>Sagen er, at denne:</p>\n<p><a href=\"https://scandlines.service-now.com/nav_to.do?uri=%2Fsysevent_email_action.do%3Fsys_id%3D0a9fe2f7dbb453008772969adb961994%26sysparm_record_list%3Dactive%253dtrue%255ename%253e%253dsla%255eORDERBYname%26sysparm_record_row%3D2%26sysparm_record_rows%3D22%26sysparm_record_target%3Dsysevent_email_action%26sysparm_view%3Dadvanced%26sysparm_view_forced%3Dtrue\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://scandlines.service-now.com/nav_to.do?uri=%2Fsysevent_email_action.do%3Fsys_id%3D0a9fe2f7dbb453008772969adb961994%26sysparm_record_list%3Dactive%253dtrue%255ename%253e%253dsla%255eORDERBYname%26sysparm_record_row%3D2%26sysparm_record_rows%3D22%26sysparm_record_target%3Dsysevent_email_action%26sysparm_view%3Dadvanced%26sysparm_view_forced%3Dtrue</a></p>\n<p>…notifikation, \"SLA breached Incidents\" som jeg har tilrettet lidt ud fra \"default-notifikationen\" \"SLA Breached\" ikke virker. Den virker fint i preview – men IKKE i den mail, der sendes til mig – felter som \"Caller\", \"Assigned to\" og \"Number\" er tomme i mailen:</p>\n<p>På forhånd tak!</p>\n<p>Med venlig hilsen / Best regards</p>\n<p>Ole Rasmussen\nIT Incident Manager</p>\n<p>Scandlines Danmark ApS\nMobile:+45 72 68 69 74</p>\n<p><a href=\"http://intranet/Danish/Vaerktoejer/Teknisk-support/~/media/19F6C9B3465E4759ADFA4F992715A022.ashx?h=67&#x26;w=189&#x26;as=1\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://intranet/Danish/Vaerktoejer/Teknisk-support/~/media/19F6C9B3465E4759ADFA4F992715A022.ashx?h=67&#x26;w=189&#x26;as=1</a> </p>\n<p>Main office: Scandlines Danmark ApS, Havneholmen 25, 8. sal, DK-1561 København V\nCVR: 18605600 København\nManagement: Søren Poulsgaard Jensen, Per Johannesen Madsen</p>\n<p>Chairman: Frank Rossen</p>\n<p>From: Tim Unnerup Husum [mailto:tuh@syspeople.dk]\nSent: 17. maj 2018 12:08\nTo: Rasmussen, Ole <a href=\"mailto:Ole.Rasmussen@scandlines.com\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ole.Rasmussen@scandlines.com</a>\nSubject: Projektopstart</p>\n<p>Hej Ole,</p>\n<p>Lige en ganske kort status.</p>\n<p>Vi har et internt møde tirsdag hvor jeg forventer de sidste punkter ift. ServiceNow og timingen af jeres opgradering bliver afklaret.</p>\n<p>Umiddelbart herefter vil jeg have en projektplan klar til dig.</p>\n<p>Hvis du har nogle spørgsmål er du velkommen til at tage fat i mig, ellers hører du fra mig i starten af næste uge.</p>\n<p>Venlig hilsen / Best regards</p>\n<p>Tim Unnerup Husum\nProject Manager</p>\n<h3 id=\"recognoscering\"><a href=\"#recognoscering\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Recognoscering</h3>\n<p>HER MANGLER ET AFSLUTTENDE P-TAG - GÆLDER OGSÅ I PROD!!!\nEmail script <code>incident_additional_details</code>:</p>\n<pre><code>template.print('&#x3C;p>' + gs.getMessage('Caller') + ': ${caller_id}&#x3C;br/>');\ntemplate.print('&#x3C;p>' + gs.getMessage('Category') + ': ${category}&#x3C;/p>');\ntemplate.print('&#x3C;p>' + gs.getMessage('Severity') + ': ${severity}&#x3C;/p>');\ntemplate.print('&#x3C;p>' + gs.getMessage('Priority') + ': ${priority}&#x3C;/p>');\ntemplate.print('&#x3C;p>' + gs.getMessage('Comments') + ': ${comments}&#x3C;/p>');\n</code></pre>\n<p>Af disse er det kun \"Comments\", der findes som direkte key i messages-oversættelsestabellen. Mens \"Category\" findes som \"category\". Resten mangler. Kan det stoppe scriptet?</p>\n<p>Notification <code>incident_additional_details</code> har ingen email template.</p>\n<h5 id=\"preview-test\"><a href=\"#preview-test\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Preview test</h5>\n<p><code>ìncident_body_header</code> viser det, den skal.</p>\n<p>Assigned to, Caller og number fungerer fint i preview af INC0023274.</p>\n<p>Take me to the incident leder til det rigtige sted.</p>\n<p><a href=\"https://community.servicenow.com/community?id=community_question&#x26;sys_id=5c004feddb58dbc01dcaf3231f9619c3\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://community.servicenow.com/community?id=community_question&#x26;sys_id=5c004feddb58dbc01dcaf3231f9619c3</a></p>\n<blockquote>\n<p>any contents in \"Message HTML\" or \"Message text\" will override the template.</p>\n</blockquote>\n<p>Mailen trigges af eventet <code>sla.warning.breach</code>, som kører fra <code>task_sla</code>-tabellen. Kan tabelskiftet spille en rolle her?</p>\n<p><code>sla.warning.breach</code> trigger også notificationen \"SLA breached\", som knytter sig til <code>task_sla</code>-tabellen.</p>\n<h3 id=\"eksempel-fra-prod\"><a href=\"#eksempel-fra-prod\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Eksempel fra prod</h3>\n<p><a href=\"https://scandlines.service-now.com/nav_to.do?uri=%2Fsys_email.do%3Fsys_id%3D206317e0db5793809c2af5b31d961989%26sysparm_record_target%3Dsys_email%26sysparm_record_row%3D12%26sysparm_record_rows%3D5067%26sysparm_record_list%3DsubjectCONTAINSSLA%255EORDERBYDESCsys_created_on\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://scandlines.service-now.com/nav_to.do?uri=%2Fsys_email.do%3Fsys_id%3D206317e0db5793809c2af5b31d961989%26sysparm_record_target%3Dsys_email%26sysparm_record_row%3D12%26sysparm_record_rows%3D5067%26sysparm_record_list%3DsubjectCONTAINSSLA%255EORDERBYDESCsys_created_on</a></p>\n<p>Subject: \"!!! SLA breach warning. Incident Assigned to:  for . Caller: \"</p>\n<p>Body:</p>\n<pre><code>&#x3C;html>&#x3C;head>&#x3C;/head>&#x3C;body>&#x3C;div>Caller: &#x3C;br>Number: &#x3C;br>Assigned to: &#x3C;br>Header: &#x3C;p>&#x3C;font size=\"6\" color=\"#808080\" face=\"helvetica\"> - &#x3C;/font>&#x3C;/p>&#x3C;/div>\n&#x3C;div>&#x3C;p>&#x3C;font size=\"4\" color=\"#999999\" face=\"helvetica\">&#x3C;strong>Additional Details:&#x3C;/strong>&#x3C;/font>&#x3C;/p>&#x3C;font size=\"3\" color=\"#999999\" face=\"helvetica\">&#x3C;p>Caller: &#x3C;br>&#x3C;/p>&#x3C;p>category: &#x3C;/p>&#x3C;p>Severity: &#x3C;/p>&#x3C;p>Priority: &#x3C;/p>&#x3C;p>Comments: &#x3C;/p>&#x3C;/font>&#x3C;/div>\n&#x3C;div>&#x3C;p>&#x3C;font size=\"3\" color=\"#808080\" face=\"helvetica\">You can view all the details of the incident by following the link below:&#x3C;/font>&#x3C;/p>&#x3C;font face=\"helvetica\">&#x3C;a href=\"task_sla.do?sys_id=8abd3947dbc35f409c2af5b31d96194b&#x26;amp;sysparm_stack=task_sla_list.do?sysparm_query=active=true\" style=\"background-color: #278efc;border: 1px solid #0368d4;color: #ffffff;font-size: 16px;font-family: Helvetica, Arial, sans-serif;text-decoration: none; border-radius: 3px;-webkit-border-radius: 3px;-moz-border-radius: 3px;display: inline-block;padding: 5px;\">Take me to the Incident&#x3C;/a>&#x3C;/font>&#x3C;br>&#x3C;br>&#x3C;p>&#x3C;font size=\"3\" color=\"#808080\" face=\"helvetica\">Thank you.&#x3C;br>&#x3C;br>Best regards&#x3C;br>IT HelpDesk&#x3C;/font>&#x3C;/p>&#x3C;/div>&#x3C;div>&#x26;nbsp;&#x3C;/div>&#x3C;div style=\"display:inline\">Ref:MSG0147911&#x3C;/div>&#x3C;/body>&#x3C;/html>\n</code></pre>\n<p>caller_id, assigned_to og number virker hverken i prod/test eller i subject/body.</p>\n<h3 id=\"seneste-sla-breached-incident-mail-fra-prod\"><a href=\"#seneste-sla-breached-incident-mail-fra-prod\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Seneste SLA breached incident-mail fra prod</h3>\n<p>SLA breached incident - email: 2018-07-11 18:29:34</p>\n<p>Alt mangler.</p>\n<p><img src=\"C:/Users/jl/Documents/noter/scandlines/Scandlines%20-%20Caller,%20Assigned%20to%20og%20Number%20er%20tomme%20i%20mail/attachments/SLAbreachedPROD.PNG\"></p>\n<table>\n<thead>\n<tr>\n<th>Egenskab</th>\n<th>Navn</th>\n<th>Test/prod</th>\n<th>Table</th>\n<th>Parm 1/2 ¤ Category</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"https://scandlines.service-now.com/nav_to.do?uri=%2Fsysevent.do%3Fsys_id%3D8e5357e0db5793809c2af5b31d961996\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Event</a></td>\n<td>sla.warning.breach</td>\n<td>Prod</td>\n<td>task_sla</td>\n<td>/ null ¤</td>\n</tr>\n<tr>\n<td>Notification</td>\n<td>SLA breached Incident</td>\n<td>Prod</td>\n<td>Incident</td>\n<td>¤ Incident</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"seneste-sla-breached-mail-fra-prod\"><a href=\"#seneste-sla-breached-mail-fra-prod\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Seneste SLA breached-mail fra prod</h3>\n<p>SLA breached - email: 2018-07-11 18:29:34</p>\n<p>Subject virker:\n\"SLA breach warning. Task Assigned to: Christian Brueckner for INC0023709 \"</p>\n<p>Det bygger på dot.walk til task:\n\"SLA breach warning. Task Assigned to: ${task.assigned_to} for ${task.number}\"</p>\n<p>Resten virker ikke.\nHer er der heller ikke refereret til task.</p>\n<p><img src=\"C:/Users/jl/Documents/noter/scandlines/Scandlines%20-%20Caller,%20Assigned%20to%20og%20Number%20er%20tomme%20i%20mail/attachments/SLAbreachedPROD.PNG\"></p>\n<table>\n<thead>\n<tr>\n<th>Egenskab</th>\n<th>Navn</th>\n<th>Test/prod</th>\n<th>Table</th>\n<th>Parm 1/2 ¤ Category</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"https://scandlines.service-now.com/nav_to.do?uri=%2Fsysevent.do%3Fsys_id%3D8e5357e0db5793809c2af5b31d961996\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Event</a></td>\n<td>sla.warning.breach</td>\n<td>Prod</td>\n<td>task_sla</td>\n<td>/ null ¤</td>\n</tr>\n<tr>\n<td>Notification</td>\n<td>SLA breached</td>\n<td>Prod</td>\n<td>Task SLA</td>\n<td>¤ Task SLA</td>\n</tr>\n</tbody>\n</table>\n<p>Eventet er det samme på de to notifikationer.</p>\n<h3 id=\"spørgsmål-til-kim\"><a href=\"#sp%C3%B8rgsm%C3%A5l-til-kim\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Spørgsmål til KIM</h3>\n<ol>\n<li>Hvor bliver eventet <code>sla.warning.breach</code> kastet?</li>\n<li>Hvordan kan jeg lettest kaste eventet i forb. m. test?</li>\n<li>Hvorfor ligger der ingen \"SLA breached incident\"-mails i test - men kun i prod?</li>\n<li>Hvorfor bruges Incident-tabellen til det her? Det tyder på, at mailen kan fungere, hvis den bygger på task_sla-tabellen.</li>\n<li>Hvor er det, du har skiftet til f.eks. <code>Caller: ${task.caller_id}</code>?</li>\n</ol>\n<h3 id=\"teracom-kik\"><a href=\"#teracom-kik\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Teracom-kik</h3>\n<p>Her bygger OOB-notifikationen \"SLA breached\" (uændret) på <code>task_sla</code>-tabellen. F.eks. benyttes <code>SLA breach warning for ${task.number}</code></p>\n<p>Incident-tabellen extender task. Men det gør <code>task_sla</code> ikke!!! Hvorfor virker det så at dot-walke til <code>task.number</code>.</p>\n<h3 id=\"man-skal-scripte-sig-fra-task_slaover-i-incident\"><a href=\"#man-skal-scripte-sig-fra-task_slaover-i-incident\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Man skal scripte sig fra <code>task_sla</code>over i <code>incident</code></h3>\n<p>Det må være underforstået, at der ikke findes nogen dot-walk vej fra task_sla til incident / eller omvendt.\n<a href=\"https://community.servicenow.com/community?id=community_question&#x26;sys_id=c5305be5dbdcdbc01dcaf3231f96197c\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://community.servicenow.com/community?id=community_question&#x26;sys_id=c5305be5dbdcdbc01dcaf3231f96197c</a></p>\n<h3 id=\"tilbage-melding-til-kim\"><a href=\"#tilbage-melding-til-kim\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Tilbage melding til Kim</h3>\n<p>Har lavet helt ny email notifikation \"SLA breached incident\", som ligger på trask_sla tabellen. Det vigtigste er, at den kalder det nye email script \"sla_breached_incident\", som henter alt ind fra incident og sys_journal_field helt custom.</p>\n<p>Har testet fra script baground, hvor det ser ud til at virke. Synes ikke rigtig, det fungerer at teste den her slags med preview notification.</p>\n<p>Kan du strikke en test sammen, der fungerer?</p>\n<h3 id=\"sådan-kaster-du-et-event-fra-script-background\"><a href=\"#s%C3%A5dan-kaster-du-et-event-fra-script-background\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Sådan kaster du et event fra script background</h3>\n<pre><code>  var incidentGR = new GlideRecord('incident');\n\n    incidentGR.get('number', 'INC0011376');\n\n    incidentGR.query();\n\n    var tempNumber;\n\n    if (incidentGR.next()) {\n\n        tempNumber = incidentGR.number;\n\n        gs.eventQueue('sla.warning.breach', current, tempNumber, gs.getUserID());   \n}\n</code></pre>\n<h3 id=\"kald-af-mail-scripts\"><a href=\"#kald-af-mail-scripts\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Kald af mail scripts</h3>\n<p><a href=\"https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/script/server-scripting/reference/r_ExScptEmlNtfn.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://docs.servicenow.com/bundle/jakarta-servicenow-platform/page/script/server-scripting/reference/r_ExScptEmlNtfn.html</a></p>\n<p>Skal refereres i html med:\n<code>${mail_script:script name}</code> - vi mangler \"mail_script\"...</p>\n<p>Dvs. at <code>${sla_breached_incident}</code> måske skal hedde</p>\n<p><code>${mail_script:sla_breached_incident}</code></p>\n<h3 id=\"nyt-forsøg-efter-ferien\"><a href=\"#nyt-fors%C3%B8g-efter-ferien\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Nyt forsøg efter ferien</h3>\n<pre><code>task_slaId = '00d0c346dba583402903f1c41d9619b1';\n\nincNumber = 'INC0011376';\n\nincSysId = '3189e20adba18f40c7d0f5e51d961914';\n \n var incidentGR = new GlideRecord('incident');\n\n    incidentGR.get(incSysId);\n\n    incidentGR.query();\n\n    var tempNumber;\n\nvar tempSysId;\n\ngs.info(incidentGR.getRowCount());\n\n    if (incidentGR.next()) {\n\ntempSysId = incidentGR.number;\n\n        tempNumber = incidentGR.number.getDisplayValue();\n\ngs.info(tempNumber + ' - ' + incSysId);\n\n        gs.eventQueue('sla.warning.breach', task_slaId, tempNumber, gs.getUserID());    \n}\n</code></pre>\n<h3 id=\"eventet-slawarningbreachkastes-af-workflow-på-task_sla\"><a href=\"#eventet-slawarningbreachkastes-af-workflow-p%C3%A5-task_sla\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Eventet <code>sla.warning.breach</code>kastes af Workflow på <code>task_sla</code></h3>\n<p><a href=\"https://scandlinestest.service-now.com/workflow_ide.do?sysparm_sys_id=14bdf236cb333100d71cb9c0c24c9c90\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://scandlinestest.service-now.com/workflow_ide.do?sysparm_sys_id=14bdf236cb333100d71cb9c0c24c9c90</a></p>\n<h3 id=\"notifikationer\"><a href=\"#notifikationer\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Notifikationer</h3>\n<table>\n<thead>\n<tr>\n<th>Navn</th>\n<th>Tabel</th>\n<th>Triggerevent</th>\n<th>Subject</th>\n<th>Body</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>SLA breached Incident (+PROD)</td>\n<td>Incident</td>\n<td>sla.warning.breach</td>\n<td>!!! SLA breach warning. Incident Assigned to: ${assigned_to} for ${number}. Caller: ${caller_id}<br>!!! SLA breach warning. Incident Assigned to:  for . Caller:</td>\n<td>Caller: ${caller_id}<br>Number: ${number}<br>Assigned to: ${assigned_to}<br>Header: ${mail_script:incident_body_header}<br>${mail_script:incident_additional_details}<br>${mail_script:incident_take_me_to_the_incident}<br>Caller: Number: Assigned to: Header: Additional Details: Caller: category: Severity: Priority: Comments:</td>\n</tr>\n<tr>\n<td>SLA breached Incident</td>\n<td>task_sla</td>\n<td>sla.warning.breach</td>\n<td>SLA breach warning. Incident Assigned to: ${task.assigned_to} for ${task.number}<br>SLA breach warning. Incident Assigned to:  for</td>\n<td>${mail_script:sla_breached_incident}<br>TOM MAIL</td>\n</tr>\n<tr>\n<td>SLA breached (+PROD)</td>\n<td>task_sla</td>\n<td>sla.warning.breach</td>\n<td>SLA breach warning. Task Assigned to: ${task.assigned_to} for ${task.number}<br>SLA breach warning. Task Assigned to: Randi Dietz Christensen for INC0024876</td>\n<td>Original breach time: ${original_breach_time}+++++++<br>${mail_script:incident_body_header}<br>+++++++<br>${mail_script:incident_additional_details}<br>+++++++<br>${mail_script:incident_take_me_to_the_incident}<br>+++++++<br>Additional Details: Caller: category: Severity: Priority: Comments:</td>\n</tr>\n<tr>\n<td>SLA warning Incident (+PROD)</td>\n<td>incident</td>\n<td>sla.warning</td>\n<td>! SLA: Assign. to: ${incident.assigned_to}, No. ${incident.number} Caller: ${incident.caller_id}<br>! SLA: Assign. to: , No.  Caller:</td>\n<td>Caller: ${caller_id}<br>Number: ${number}<br>Assigned to: ${assigned_to}<br>Short description: ${short_description}<br>${mail_script:incident_additional_details}<br>${mail_script:incident_take_me_to_the_incident}<br>INGEN AF FELTERNE ER UDFYLDT I PROD</td>\n</tr>\n<tr>\n<td>SLA warning  (+PROD)</td>\n<td>task_sla</td>\n<td>sla.warning</td>\n<td>SLA warning for ${task.number}<br>SLA warning for INC0024876</td>\n<td>SLA warning for ${task.number}<br>${mail_script:incident_take_me_to_the_incident}Created: ${sys_created_on}<br>SER UD TIL AT VIRKE I PROD</td>\n</tr>\n</tbody>\n</table>\n<pre><code>task_slaId = '00d0c346dba583402903f1c41d9619b1';\n\nvar task_slaGR = new GlideRecord('task_sla');\n\n    task_slaGR.get(task_slaId);\n\n    task_slaGR.query();\n\n   if (task_slaGR.next()) {\n\ntempId = task_slaGR.task;\n\n        tempNumber = task_slaGR.task.getDisplayValue();\n}\n\ngs.info('task_sla antal: ' + task_slaGR.getRowCount() + ' tempNumber: ' + tempNumber + ' tempId: ' + tempId);\n\n var incidentGR = new GlideRecord('incident');\n\n    incidentGR.get(tempId);\n\n    incidentGR.query();\n\n    var tempNumber;\n\nvar tempSysId;\n\ngs.info(incidentGR.getRowCount());\n\n    if (incidentGR.next()) {\n\ntempSysId = incidentGR.sys_id;\n\n        tempNumber = incidentGR.number;\n\ngs.info(tempNumber + ' - ' + tempSysId);\n\n/* Der SKAL stå current i stedet for task_slaId - ellers kører notifikationen ikke */\n        gs.eventQueue('sla.warning.breach', current, tempNumber, gs.getUserID());   \n}\n</code></pre>\n<h3 id=\"task_slagr-objektet-skal-sendes-med-inde-fra-loopet\"><a href=\"#task_slagr-objektet-skal-sendes-med-inde-fra-loopet\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a><code>task_slaGR</code>-objektet skal sendes med inde fra loopet!!!</h3>\n<p>DEN HER VIRKER!!!</p>\n<pre><code>task_slaId = '0022d11edb71c780c7d0f5e51d96197b';\n\n    var tempNumber;\n\n    var tempId;\n\nvar task_slaGR = new GlideRecord('task_sla');\n\n    task_slaGR.get(task_slaId);\n\n    task_slaGR.query();\n\n   if (task_slaGR.next()) {\n\ntempId = task_slaGR.task;\n\n        tempNumber = task_slaGR.task.getDisplayValue();\n\ngs.eventQueue('sla.warning.breach', task_slaGR, tempNumber, gs.getUserID());    \n}\n\ngs.info('task_sla antal: ' + task_slaGR.getRowCount() + ' tempNumber: ' + tempNumber + ' tempId: ' + tempId);\n\n var incidentGR = new GlideRecord('incident');\n\n    incidentGR.get(tempId);\n\n    incidentGR.query();\n\nvar tempSysId;\n\ngs.info(incidentGR.getRowCount());\n\n    if (incidentGR.next()) {\n\ntempSysId = incidentGR.sys_id;\n\n        tempNumber = incidentGR.number;\n\ngs.info(tempNumber + ' - ' + tempSysId);\n\n}\n</code></pre>\n<p>Forkortet version:</p>\n<pre><code>task_slaId = '0be5ee9fdb920b00c7d0f5e51d9619b9';\n\n    var tempNumber;\n\n    var tempId;\n\nvar task_slaGR = new GlideRecord('task_sla');\n\n    task_slaGR.get(task_slaId);\n\n    task_slaGR.query();\n\n   if (task_slaGR.next()) {\n\ntempId = task_slaGR.task;\n\n        tempNumber = task_slaGR.task.getDisplayValue();\n\ngs.eventQueue('sla.warning.breach', task_slaGR, tempNumber, gs.getUserID());    \n}\n</code></pre>\n<h3 id=\"hente-assigned_to-fra-incident-til-parameter\"><a href=\"#hente-assigned_to-fra-incident-til-parameter\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Hente assigned_to fra Incident til parameter</h3>\n<pre><code>task_slaId = '0be5ee9fdb920b00c7d0f5e51d9619b9';\n\n    var tempNumber;\n\n    var tempId;\n\nvar task_slaGR = new GlideRecord('task_sla');\n\n    task_slaGR.get(task_slaId);\n\n    task_slaGR.query();\n\n   if (task_slaGR.next()) {\n\ntempId = task_slaGR.task;\n\n        tempNumber = task_slaGR.task.getDisplayValue();\n\n/* Get assigned_to from Incident as parameter */\n\nvar assignedTo;\n\n var incidentGR = new GlideRecord('incident');\n\n    incidentGR.get(tempId);\n\n    incidentGR.query();\n\ngs.info(incidentGR.getRowCount());\n\n    if (incidentGR.next()) {\n\nassignedTo = incidentGR.assigned_to.getDisplayValue();\n\n        tempNumber = incidentGR.number;\n\n/* gs.info(tempNumber + ' - ' + assignedTo); */\n\n}\n\ngs.eventQueue('sla.warning.breach', task_slaGR, tempNumber, assignedTo);    \n}\n</code></pre>\n<p><code>AssignedTo</code> hentes ind i subject på email notifikationen med <code>SLA breach warning. Task assigned to ${event.parm2} for ${event.parm1}</code> - Ved at bruge udelukkende parametre i subject bliver det lettere at overføre variabler fra workflow-events, hvor jeg er helt sikker på at have kontrol over de to parametre.</p>\n<h3 id=\"kims-test-23-8-18\"><a href=\"#kims-test-23-8-18\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Kims test 23-8-18</h3>\n<p>Mail 1:\nSubject: ! SLA: Assign. to: , No.  Caller:\nEvent: sla.warning\nNotification: SLA warning Incident\nBody: Ingen variabler til stede</p>\n<p>Mail 2:\nSubject: SLA warning for INC0023306\nEvent: sla.warning\nNotification: SLA warning\nBody: Ingen variabler til stede</p>\n<p>Mail 3:\nSubject: SLA breach warning. Task Assigned to:  for INC0023306\nEvent: sla.warning.breach\nNotification: SLA breached\nBody: Ingen variabler til stede</p>\n<p>Mail 4:\nSubject: !!! SLA breach warning. Incident Assigned to:  for . Caller:\nEvent: sla.warning.breach\nNotification: SLA breached Incident\nBody: Variabler til stede men ikke udfyldt</p>\n<p>Se alle fire notifications, som trigges af <code>sla.warning.breach</code> - de tre er fra <code>task_sla</code> - hvorfor kører kun de to - ikke den der starter med <code>[TEST]</code>:\n<a href=\"https://scandlinestest.service-now.com/nav_to.do?uri=%2Fsysevent_email_action_list.do%3Fsysparm_query%3Devent_nameSTARTSWITHsla.warning.breach%26sysparm_first_row%3D1%26sysparm_view%3D%26sysparm_choice_query_raw%3D%26sysparm_list_header_search%3Dtrue\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://scandlinestest.service-now.com/nav_to.do?uri=%2Fsysevent_email_action_list.do%3Fsysparm_query%3Devent_nameSTARTSWITHsla.warning.breach%26sysparm_first_row%3D1%26sysparm_view%3D%26sysparm_choice_query_raw%3D%26sysparm_list_header_search%3Dtrue</a></p>\n<h3 id=\"svar-til-kim-23-8-18\"><a href=\"#svar-til-kim-23-8-18\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Svar til Kim 23-8-18</h3>\n<p>Ja, vi skal have SLA workflow til at gøre det samme som min script background, hvor alle variabler bliver udfyldt i mailen.</p>\n<p>Er det det her workflow på task_sla, som styrer det hele:\n<a href=\"https://scandlinestest.service-now.com/workflow_ide.do?sysparm_sys_id=14bdf236cb333100d71cb9c0c24c9c90\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://scandlinestest.service-now.com/workflow_ide.do?sysparm_sys_id=14bdf236cb333100d71cb9c0c24c9c90</a></p>\n<p>Uanset hvad:</p>\n<p>Det korrekte workflow stage (som du nok er den eneste, der kan finde) skal gøre følgende:\n1)\tKastet dette event: sla.warning.breach\n2)\tParm1 = current.task.getDisplayValue()\n3)\tParm2 = </p>\n<p>var incidentGR = new GlideRecord('incident');</p>\n<pre><code>incidentGR.get(current.task);\n\nincidentGR.query();\n\nif (incidentGR.next()) {\n</code></pre>\n<p>var assignedTo = incidentGR.assigned_to.getDisplayValue();</p>\n<p>}</p>\n<p>assignedTo</p>\n"}},"context":{}}