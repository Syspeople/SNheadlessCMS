{"hash":"9aa6fc4199609a4def2827be26b3f097c6fcb218","data":{"note":{"id":"b1940d48214ec1c9b7277aaa3d8a1124","title":"PROJT0001565 - rettelse til request counter","year":2019,"content":"<p>LP: PROJT0001565 - rettelse til request counter\n<a href=\"https://app.liquidplanner.com/space/143625/projects\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://app.liquidplanner.com/space/143625/projects</a></p>\n<p>PROJT0001565</p>\n<p>Opgaven:\nTop menu header på Service Portalen(<a href=\"https://dkcompanydev1.service-now.com/sp?id=index\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://dkcompanydev1.service-now.com/sp?id=index</a>) med menu-punkt 'Requests' som er udstyret med rundt blåt batch med en counter/record watcher med tal, som kunden ønsker IKKE medregner records i state=Resolved + Closed.</p>\n<p>Ressource:\nDet er sandsynligvis i scriptet her (<a href=\"https://dkcompanydev1.service-now.com/nav_to.do?uri=%2Fsp_rectangle_menu_item.do%3Fsys_id%3D7c686d00d7200200a9ad1e173e24d4e9%26sysparm_view%3D%26sysparm_domain%3Dnull%26sysparm_domain_scope%3Dnull%26sysparm_record_row%3D1%26sysparm_record_rows%3D1%26sysparm_record_list%3DlabelSTARTSWITHrequests%255eORDERBYorder\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://dkcompanydev1.service-now.com/nav_to.do?uri=%2Fsp_rectangle_menu_item.do%3Fsys_id%3D7c686d00d7200200a9ad1e173e24d4e9%26sysparm_view%3D%26sysparm_domain%3Dnull%26sysparm_domain_scope%3Dnull%26sysparm_record_row%3D1%26sysparm_record_rows%3D1%26sysparm_record_list%3DlabelSTARTSWITHrequests%255eORDERBYorder</a>) </p>\n<h3 id=\"kims-noter\"><a href=\"#kims-noter\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Kims noter</h3>\n<p>Forsøg med search query taget fra list filter:</p>\n<ul>\n<li>active=true^incident_stateNOT IN6,7</li>\n<li>active=true^u_choice_custom_stateNOT INResolved,Closed</li>\n</ul>\n<p>= Not working =)</p>\n<h3 id=\"menu-item-requests\"><a href=\"#menu-item-requests\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Menu Item Requests</h3>\n<p><a href=\"https://dkcompanydev1.service-now.com/nav_to.do?uri=%2Fsp_rectangle_menu_item.do%3Fsys_id%3D7c686d00d7200200a9ad1e173e24d4e9%26sysparm_view%3D%26sysparm_domain%3Dnull%26sysparm_domain_scope%3Dnull%26sysparm_record_row%3D1%26sysparm_record_rows%3D1%26sysparm_record_list%3DlabelSTARTSWITHrequests%255eORDERBYorder\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://dkcompanydev1.service-now.com/nav_to.do?uri=%2Fsp_rectangle_menu_item.do%3Fsys_id%3D7c686d00d7200200a9ad1e173e24d4e9%26sysparm_view%3D%26sysparm_domain%3Dnull%26sysparm_domain_scope%3Dnull%26sysparm_record_row%3D1%26sysparm_record_rows%3D1%26sysparm_record_list%3DlabelSTARTSWITHrequests%255eORDERBYorder</a></p>\n<p>Tilføjet til server scriptet:\n<code>u_choice_custom_stateNOT INResolved,Closed^</code></p>\n<p>Egen kopi af query:</p>\n<pre><code>active=true^u_choice_custom_stateNOT INResolved,Closed\n</code></pre>\n<p>Prøver med en, der skal give en collection på 0 incidents:\nactive=true^u_choice_custom_state=Closed</p>\n<p><code>t.record_watchers.push({'table':'incident','filter':'u_choice_custom_state=Closed^active=true^caller_id=' + u});</code>\nændrer ingenting - stadig 2 requests!</p>\n<p>Den her ændrer dog noget:</p>\n<pre><code>z.addQuery('caller_iddd', gs.getUserID());\n</code></pre>\n<h3 id=\"løsning-og-konklusion\"><a href=\"#l%C3%B8sning-og-konklusion\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Løsning og konklusion</h3>\n<p>Menu-punktet Requests i headeren på DK Companys portal skal gå ned og tælle den indloggede persons incidents, som ikke er closed eller resolved.</p>\n<p>Men skulle tro, at filtret lå i denne linie:\n<code>t.record_watchers.push({'table':'incident','filter':'active=true^caller_id=' + u});</code>\nMen der vises de samme og det samme antal requests - selv med de indsættelse af kriterier, der skal resultere i nul hits.</p>\n<p>Et kik længere nede i scriptet afslører dog, at søgningen faktisk finder sted her. Søgningen er så udvidet med de to linier med \"!=\":</p>\n<p>z.addQuery('u_choice_custom_state', '!=', 'Resolved');\nz.addQuery('u_choice_custom_state', '!=', 'Closed');</p>\n<p>hvorefter filtret ser ud til at fungere som ønsket. Ellers sig til.</p>\n<p>Løsningen er lagt i update set \"PROJT0001565 - rettelse til request counter\", som er completed.</p>\n<pre><code>var z = new GlideRecord('incident');\nz.addActiveQuery();\nz.addQuery('caller_id', gs.getUserID());\nz.addQuery('u_choice_custom_state', '!=', 'Resolved');\nz.addQuery('u_choice_custom_state', '!=', 'Closed');\nz.orderByDesc('sys_updated_on');\nz.setLimit(max);\nz.query();\nwhile (z.next()) {\nif (!z.canRead())\ncontinue;\n</code></pre>\n"}},"context":{}}